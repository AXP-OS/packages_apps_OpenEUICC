name: "Sync"

on:
  schedule:
    - cron:  '45 9 * * *'
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow pushing via github token
permissions:
  contents: write # allow git push

jobs:
  call-org-workflow:
    name: "Calling AXP workflow"
    uses: AXP-OS/.github/.github/workflows/sync_upstream.yml@main
    with:
        remote-server: gitea.angry.im
        remote-repo: PeterCxy/OpenEUICC  # <- remote repo name (e.g. LineageOS/foo)
        remote-branch:  master # <- remote branch name
        local-repo: ${{ github.repository_owner }}/${{ github.event.repository.name }}
        local-branch: "main"
        dryrun: false  # <- set to false after a test run
    secrets: inherit

  call-build-wf:
    runs-on: ubuntu-latest
    
    steps:
    
      - name: "Download commit result"
        uses: actions/download-artifact@v4
        with:
          name: commit_result

      - name: "Check result"
        shell: bash
        id: cmres
        run: |
          source cm.res
          echo "commit_result=$new_commits" >> $GITHUB_ENV
          
      - name: "Trigger APK build"
        if: "${{ env.commit_result }}"
        uses: ./.github/workflows/apk.yml
